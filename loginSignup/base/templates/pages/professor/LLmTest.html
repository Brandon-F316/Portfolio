{% extends "pages/main.html" %}
{% block content %}


    <form method="POST" enctype="multipart/form-data" class="mb-5">
        <h3>Extract Learning Outcomes from file</h3>
        {% csrf_token %}
        <div class="form-group">
            <label for="file">Upload Syllabus File</label>
            {{ form.file }}
        </div>
        <button type="submit" class="btn btn-primary">Extract</button>

</form>


<!-- Uploaded files section -->
<h2 class="mt-5">Your Uploaded Files</h2>
<ul id="file-list" class="list-group">
    {% for file in uploaded_files %}

    <li id="file-{{ file.data_id }}" class="list-group-item">
        <strong>{{ file.file.name }}</strong> <br>
        {{ file.data_id }}
        <a href="{{ file.file.url }}" target="_blank" class="btn btn-link">View File</a>
        <button onclick="deleteFile('{{ file.data_id }}')" class="btn btn-danger btn-sm ml-3">Delete</button>
    
        <h3 class="mt-3">Extracted Text</h3>
        <ul class="list-group">
            {% if file.criterion %}
                <li class="list-group-item">{{ file.criterion }}</li>
            {% endif %}
        </ul>
    </li>
    {% empty %}
        <li class="list-group-item">You haven't uploaded any files yet.</li>
    {% endfor %}
</ul>


<script>

function deleteFile(dataId) {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const url = `/delete_file/${dataId}/`;

    console.log("Requesting URL:", url); // Debugging line

    fetch(url, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById(`file-${dataId}`).remove(); // Remove file from list
        } else {
            alert("Failed to delete the file.");
        }
    })
    .catch(error => console.error('Error:', error));
}



</script>

{% endblock content %}