{% extends "pages/main.html" %}
{% block content %}


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Enter Questions Here</title>

  <style>
    .input-group {
      margin: 5px 0;
    }
  </style>

</head>
<body>
  <h2>Enter Your Questions Here</h2>

  <div id="textBoxContainer">
    <div class="input-group">
      <input type="text" placeholder="Enter Question">
    </div>
  </div>

  <button onclick="addTextBox()">Add Question</button>
  <button onclick="removeTextBox()">Remove Question</button>
  <button onclick="combineText()">Combine Text</button>

  <p><strong>Combined:</strong> <span id="result"></span></p>

</body>
</html>




<h2 class="mt-5">Your Extracted Outcomes</h2>
<ul id="file-list" class="list-group">

{% if uploaded_file %}
    <li id="file-{{ uploaded_file.data_id }}" class="list-group-item">
        <strong>{{ uploaded_file.file.name }}</strong> <br>
        {{ uploaded_file.data_id }}
        <a href="{{ uploaded_file.file.url }}" target="_blank" class="btn btn-link">View File</a>
        <button onclick="deleteFile('{{ uploaded_file.data_id }}')" class="btn btn-danger btn-sm ml-3">Delete</button>
    
        <h3 class="mt-3">Extracted Text</h3>
        <ul class="list-group">
            {% if uploaded_file.criterion %}
                <li class="list-group-item">{{ uploaded_file.criterion }}</li>
            {% endif %}
        </ul>
    </li>
    {% else %}
    <li class="list-group-item">No file uploaded yet.</li>
{% endif %}
</ul>


<script>
    function addTextBox() {
      const container = document.getElementById("textBoxContainer");
      const div = document.createElement("div");
      div.className = "input-group";
      div.innerHTML = `<input type="text" placeholder="Enter Question">`;
      container.appendChild(div);
    }

    function removeTextBox() {
      const container = document.getElementById("textBoxContainer");
      if (container.children.length > 1) {
        container.removeChild(container.lastElementChild);
      }
    }

    function combineText() {
      const container = document.getElementById("textBoxContainer");
      const inputs = container.getElementsByTagName("input");
      const values = [];

      for (let input of inputs) {
        values.push(input.value);
      }

      const combined = values.join(" // ");
      document.getElementById("result").textContent = combined;

    }


function deleteFile(dataId) {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    const url = `/delete_file/${dataId}/`;

    console.log("Requesting URL:", url); // Debugging line

    fetch(url, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById(`file-${dataId}`).remove();
        } else {
            alert("Failed to delete the file.");
        }
    })
    .catch(error => console.error('Error:', error));
}



</script>

{% endblock content %}